<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>AI Assassins Daily Brief</title>
  <link rel="manifest" href="./manifest.webmanifest">
  <link rel="icon" href="./icon-192.png">
  <meta name="theme-color" content="#0b0f13">
  <link rel="apple-touch-icon" href="./icon-180.png">
  <style>
    :root { --bg:#070b10; --card:#101923; --border:#274463; --text:#e7eef7; --muted:#9fb0c5; --accent:#73d8ff; --glow:rgba(115,216,255,.24); }
    * { box-sizing:border-box; }
    body { margin:0; background:radial-gradient(circle at 20% 0%, #0f1724 0%, var(--bg) 45%), var(--bg); color:var(--text); font-family:"JetBrains Mono","Fira Code","IBM Plex Mono","Consolas",monospace; }
    .wrap { max-width:1120px; margin:0 auto; padding:18px; }
    .top { display:flex; justify-content:space-between; align-items:flex-start; gap:14px; flex-wrap:wrap; }
    .title { margin:0; font-size:1.35rem; }
    .sub { color:var(--muted); font-size:.9rem; margin-top:4px; }
    .controls { display:flex; gap:8px; flex-wrap:wrap; }
    button,input { border-radius:10px; border:1px solid var(--border); background:#101b29; color:var(--text); }
    button { padding:10px 14px; cursor:pointer; box-shadow:0 0 0 1px rgba(115,216,255,.12), 0 0 18px var(--glow); }
    button:disabled { opacity:.7; cursor:not-allowed; }
    input { padding:9px 10px; }
    .row { display:flex; gap:8px; flex-wrap:wrap; margin-top:12px; }
    .grid { margin-top:14px; display:grid; grid-template-columns:repeat(auto-fit,minmax(260px,1fr)); gap:12px; }
    .card { background:linear-gradient(180deg, #0e1825 0%, #0b1119 100%); border:1px solid var(--border); border-radius:12px; padding:12px; box-shadow:inset 0 0 0 1px rgba(115,216,255,.08), 0 0 18px rgba(0,0,0,.45); }
    .card h3 { margin:0 0 8px 0; font-size:1rem; }
    .badge { display:inline-flex; align-items:center; padding:4px 9px; border-radius:999px; border:1px solid var(--border); font-size:.75rem; }
    ul { margin:0; padding-left:16px; }
    .kvs { display:grid; grid-template-columns:1fr auto; row-gap:6px; }
    .muted { color:var(--muted); }
    .small { font-size:.85rem; }
    .error { margin-top:10px; padding:9px 11px; border:1px solid #8a3b3b; background:#2a1515; border-radius:10px; display:none; box-shadow:0 0 12px rgba(138,59,59,.28); }
    .loading { display:none; color:var(--accent); margin-top:10px; text-transform:uppercase; letter-spacing:.08em; text-shadow:0 0 14px var(--glow); }
    .loading::after { content:""; display:inline-block; width:10px; height:10px; margin-left:8px; border-radius:50%; background:var(--accent); box-shadow:0 0 10px var(--accent); animation:pulse 1.1s infinite ease-in-out; }
    .toast-wrap { position:fixed; right:14px; bottom:14px; display:grid; gap:8px; z-index:9999; }
    .toast { background:#0f1724; color:#e7eef7; border:1px solid #274463; border-radius:10px; padding:10px 12px; min-width:220px; box-shadow:0 8px 26px rgba(0,0,0,.5); }
    .toast.error { border-color:#8a3b3b; }
    @keyframes pulse { 0%,100% { opacity:.3; transform:scale(.8);} 50% { opacity:1; transform:scale(1);} }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <div>
        <h1 class="title" style="display:flex;align-items:center;gap:10px;">
          <img src="./icon-192.png" alt="AI Assassins" width="22" height="22" style="border-radius:4px;box-shadow:0 0 10px var(--glow);">
          <span>AI Assassins Daily Brief</span>
        </h1>
        <div class="sub">Live intelligence brief generated via Cloudflare Worker + OpenAI</div>
      </div>
      <div class="controls">
        <button id="btnGenerate">Generate Brief</button>
        <button id="btnLogin">Login</button>
        <button id="btnSubscribe">Upgrade</button>
        <button id="btnExportPdf" data-premium="true">Export PDF</button>
        <span id="subscriptionBadge" class="badge">Tier: Free</span>
      </div>
    </div>

    <div class="row">
      <input id="latInput" placeholder="Lat (e.g. 29.7604)">
      <input id="lonInput" placeholder="Lon (e.g. -95.3698)">
      <input id="focusInput" placeholder="Focus (optional)">
      <input id="toneInput" placeholder="Tone (optional)">
      <input id="icsInput" placeholder="ICS URL (optional)">
    </div>

    <div id="loadingState" class="loading">Initializing Intelligence Streamâ€¦</div>
    <div id="autoRefreshStatus" class="small muted" style="margin-top:6px;">Auto-refresh disabled</div>
    <div id="errorBox" class="error"></div>

    <div class="grid">
      <section class="card"><h3>Overnight Overview</h3><ul id="overnightOverview"><li class="muted">N/A</li></ul></section>
      <section class="card"><h3>Markets Snapshot</h3>
        <div class="kvs">
          <div>S&amp;P 500</div><div id="sp500" class="muted">N/A</div>
          <div>NASDAQ</div><div id="nasdaq" class="muted">N/A</div>
          <div>WTI</div><div id="wti" class="muted">N/A</div>
          <div>BTC</div><div id="btc" class="muted">N/A</div>
        </div>
      </section>
      <section class="card"><h3>Weather</h3><div id="weatherLocal" class="muted">N/A</div></section>
      <section class="card"><h3>Next Up Calendar</h3><ul id="calendarEvents"><li class="muted">N/A</li></ul></section>
      <section class="card"><h3>Scripture of the Day</h3><div id="scriptureDay" class="muted">N/A</div></section>
      <section class="card"><h3>Mission Priorities</h3><ul id="missionPriorities"><li class="muted">N/A</li></ul></section>
      <section class="card">
        <h3>Black Phoenix Truthwave</h3>
        <div><strong>Narrative:</strong> <span id="truthwaveNarrative" class="muted">N/A</span></div>
        <div><strong>Risk:</strong> <span id="truthwaveRisk" class="muted">N/A</span></div>
        <div><strong>Counter:</strong> <span id="truthwaveCounter" class="muted">N/A</span></div>
      </section>
      <section class="card"><h3>Top Tasks</h3><ul id="topTasks"><li class="muted">N/A</li></ul></section>
      <section class="card"><h3>Command Note</h3><div id="commandNote" class="muted">N/A</div></section>
    </div>

    <div class="grid" style="margin-top:12px;" data-premium="true">
      <section class="card">
        <h3>Past Briefs</h3>
        <ul id="pastBriefsList"><li class="muted">No saved briefs yet</li></ul>
      </section>
    </div>
  </div>
  <div id="toastContainer" class="toast-wrap" aria-live="polite"></div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <script src="./integrations.js?v=v3.1.0"></script>
  <dialog id="loginDialog" style="background:#0f1724;color:#e7eef7;border:1px solid #274463;border-radius:12px;padding:16px;max-width:360px;">
    <form id="loginForm" method="dialog" style="display:grid;gap:8px;">
      <strong>Operator Login</strong>
      <input id="loginEmail" type="email" placeholder="email">
      <input id="loginPassword" type="password" placeholder="password">
      <div style="display:flex;gap:8px;justify-content:flex-end;">
        <button value="cancel">Cancel</button>
        <button id="btnLoginSubmit" value="default">Login</button>
      </div>
    </form>
  </dialog>
  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("./sw.js").catch((error) => {
        console.error("Service worker registration failed", error);
      });
    }
  </script>
</body>
</html>
